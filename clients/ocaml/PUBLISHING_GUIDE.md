# ğŸ“¦ å‘å¸ƒåˆ° OPAM å®Œæ•´æŒ‡å—

## æ¦‚è¿°

æœ¬æŒ‡å—æä¾›å‘å¸ƒ `isa_repl` åŒ…åˆ° OPAM å®˜æ–¹ä»“åº“çš„å®Œæ•´æµç¨‹ã€‚

## ğŸ“š æ–‡æ¡£ç´¢å¼•

æˆ‘ä»¬å‡†å¤‡äº†å¤šä¸ªæ–‡æ¡£ä»¥å¸®åŠ©ä½ å®Œæˆå‘å¸ƒï¼š

1. **QUICK_PUBLISH.md** - âš¡ å¿«é€Ÿå…¥é—¨ï¼ˆæ¨èä»è¿™é‡Œå¼€å§‹ï¼‰
   - æœ€å°åŒ–æ­¥éª¤
   - é€‚åˆç†Ÿæ‚‰ OPAM çš„ç”¨æˆ·

2. **PUBLISH.md** - ğŸ“– è¯¦ç»†æŒ‡å—
   - å®Œæ•´çš„å‘å¸ƒæµç¨‹
   - åŒ…æ‹¬æ‰‹åŠ¨å’Œè‡ªåŠ¨ä¸¤ç§æ–¹å¼
   - å¸¸è§é—®é¢˜è§£ç­”

3. **RELEASE_CHECKLIST.md** - âœ… å‘å¸ƒå‰æ£€æŸ¥æ¸…å•
   - ç¡®ä¿ä¸é—æ¼ä»»ä½•æ­¥éª¤
   - è´¨é‡ä¿è¯

4. æœ¬æ–‡ä»¶ - ğŸ“‹ æ€»è§ˆå’Œå¿«é€Ÿå‚è€ƒ

## ğŸš€ ä¸‰æ­¥å¿«é€Ÿå‘å¸ƒ

å¦‚æœä½ å·²ç»ç†Ÿæ‚‰æµç¨‹ï¼Œè¿™æ˜¯æœ€å¿«çš„æ–¹æ³•ï¼š

### å‰ææ¡ä»¶
```bash
opam install dune-release -y
export GITHUB_TOKEN="your_token"  # ä» GitHub settings è·å–
```

### å‘å¸ƒå‘½ä»¤
```bash
cd clients/ocaml

# ä¸€é”®å‘å¸ƒï¼
opam exec -- dune-release tag && \
opam exec -- dune-release distrib && \
opam exec -- dune-release publish distrib && \
opam exec -- dune-release opam pkg && \
opam exec -- dune-release opam submit
```

### ç­‰å¾…å®¡æ ¸
- OPAM ç»´æŠ¤è€…ä¼šå®¡æ ¸ä½ çš„ PR
- é€šå¸¸éœ€è¦ 3-7 å¤©
- å“åº”ä»»ä½•åé¦ˆ

å®Œæˆï¼ğŸ‰

## ğŸ“– è¯¦ç»†æµç¨‹

å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡å‘å¸ƒï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ï¼š

### 1. å‡†å¤‡é˜¶æ®µ

```bash
# é˜…è¯»æ–‡æ¡£
cat QUICK_PUBLISH.md      # å¿«é€Ÿå…¥é—¨
cat PUBLISH.md            # è¯¦ç»†è¯´æ˜
cat RELEASE_CHECKLIST.md  # æ£€æŸ¥æ¸…å•

# å®‰è£…å·¥å…·
opam install dune-release -y

# é…ç½® GitHub
# è®¿é—® https://github.com/settings/tokens
# åˆ›å»º tokenï¼Œæƒé™ï¼špublic_repo
# è®¾ç½®ç¯å¢ƒå˜é‡
export GITHUB_TOKEN="ghp_xxxxxxxxxxxx"
```

### 2. è´¨é‡æ£€æŸ¥

```bash
# è¿è¡Œæ£€æŸ¥æ¸…å•
cat RELEASE_CHECKLIST.md

# å…³é”®æ£€æŸ¥é¡¹ï¼š
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æ–‡æ¡£å®Œæ•´
- [ ] ç‰ˆæœ¬å·æ­£ç¡®
- [ ] Git ä»“åº“å¹²å‡€
```

### 3. æ‰§è¡Œå‘å¸ƒ

å‚è€ƒ `QUICK_PUBLISH.md` æˆ– `PUBLISH.md` ä¸­çš„è¯¦ç»†æ­¥éª¤ã€‚

### 4. æäº¤åˆ° OPAM

ä½¿ç”¨ dune-release è‡ªåŠ¨æäº¤ï¼Œæˆ–æ‰‹åŠ¨åˆ›å»º PR åˆ° ocaml/opam-repositoryã€‚

## ğŸ” å‘å¸ƒæµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‡†å¤‡å’Œæµ‹è¯•     â”‚
â”‚  âœ“ ä»£ç å®Œæˆ     â”‚
â”‚  âœ“ æµ‹è¯•é€šè¿‡     â”‚
â”‚  âœ“ æ–‡æ¡£å®Œæ•´     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ›å»º Release   â”‚
â”‚  â€¢ Git tag      â”‚
â”‚  â€¢ GitHub releaseâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”Ÿæˆ tarball   â”‚
â”‚  dune-release   â”‚
â”‚  distrib        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æäº¤åˆ° OPAM    â”‚
â”‚  â€¢ åˆ›å»º PR      â”‚
â”‚  â€¢ CI æµ‹è¯•      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç­‰å¾…å®¡æ ¸       â”‚
â”‚  â€¢ å“åº”åé¦ˆ     â”‚
â”‚  â€¢ PR åˆå¹¶      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‘å¸ƒå®Œæˆï¼ ğŸ‰  â”‚
â”‚  opam install   â”‚
â”‚  isa_repl       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ å·¥å…·å’Œä¾èµ–

### å¿…éœ€å·¥å…·
- **dune** - æ„å»ºç³»ç»Ÿ (å·²å®‰è£…)
- **dune-release** - è‡ªåŠ¨åŒ–å‘å¸ƒå·¥å…·
- **git** - ç‰ˆæœ¬æ§åˆ¶
- **opam** - OCaml åŒ…ç®¡ç†å™¨

### å®‰è£… dune-release
```bash
opam install dune-release -y
```

### é…ç½®
```bash
# Git é…ç½®
git config --global user.name "Your Name"
git config --global user.email "your@email.com"

# GitHub token
export GITHUB_TOKEN="your_token"
```

## ğŸ“‹ æ£€æŸ¥æ¸…å•å¿«é€Ÿå‚è€ƒ

- [ ] **ä»£ç **: æ‰€æœ‰æ›´æ”¹å·²æäº¤ï¼Œæ„å»ºæˆåŠŸ
- [ ] **æµ‹è¯•**: æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ŒæœåŠ¡å™¨ç¨³å®š
- [ ] **æ–‡æ¡£**: READMEã€CHANGESã€LICENSE å®Œæ•´
- [ ] **é…ç½®**: dune-projectã€opam æ–‡ä»¶æ­£ç¡®
- [ ] **ç‰ˆæœ¬**: ç‰ˆæœ¬å·æ­£ç¡®ï¼Œtag å·²åˆ›å»º
- [ ] **GitHub**: Release å·²åˆ›å»º
- [ ] **OPAM**: PR å·²æäº¤

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: ç¬¬ä¸€æ¬¡å‘å¸ƒï¼Œåº”è¯¥çœ‹å“ªä¸ªæ–‡æ¡£ï¼Ÿ
**A**: æŒ‰é¡ºåºé˜…è¯»ï¼š
1. æœ¬æ–‡ä»¶ï¼ˆæ¦‚è§ˆï¼‰
2. QUICK_PUBLISH.mdï¼ˆå¿«é€Ÿå…¥é—¨ï¼‰
3. RELEASE_CHECKLIST.mdï¼ˆç¡®ä¿ä¸é—æ¼ï¼‰

### Q: dune-release å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ
**A**: æŸ¥çœ‹ PUBLISH.md çš„"æ‰‹åŠ¨å‘å¸ƒ"éƒ¨åˆ†ã€‚

### Q: å¦‚ä½•æ›´æ–°å·²å‘å¸ƒçš„åŒ…ï¼Ÿ
**A**:
1. æ›´æ–°ç‰ˆæœ¬å·ï¼ˆdune-projectï¼‰
2. æ›´æ–° CHANGES.md
3. é‡å¤å‘å¸ƒæµç¨‹

### Q: å‘å¸ƒéœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ
**A**:
- å‡†å¤‡å’Œæµ‹è¯•: 1-2 å°æ—¶
- æäº¤ PR: 10 åˆ†é’Ÿ
- ç­‰å¾…å®¡æ ¸: 3-7 å¤©

### Q: å¦‚ä½•æ’¤å›é”™è¯¯çš„å‘å¸ƒï¼Ÿ
**A**:
- å¦‚æœ PR æœªåˆå¹¶ï¼šå…³é—­ PRï¼Œä¿®å¤åé‡æ–°æäº¤
- å¦‚æœå·²åˆå¹¶ï¼šæäº¤æ–°ç‰ˆæœ¬ï¼Œæ ‡è®°æ—§ç‰ˆæœ¬ä¸º deprecated

## ğŸ“ è·å–å¸®åŠ©

### æ–‡æ¡£
- **å¿«é€Ÿå…¥é—¨**: QUICK_PUBLISH.md
- **è¯¦ç»†æŒ‡å—**: PUBLISH.md
- **æ£€æŸ¥æ¸…å•**: RELEASE_CHECKLIST.md
- **é¡¹ç›®æ–‡æ¡£**: README.md

### å¤–éƒ¨èµ„æº
- [OPAM å®˜æ–¹æ–‡æ¡£](https://opam.ocaml.org/doc/)
- [dune-release æŒ‡å—](https://github.com/ocamllabs/dune-release)
- [OPAM æ‰“åŒ…æŒ‡å—](https://opam.ocaml.org/doc/Packaging.html)

### è”ç³»æ–¹å¼
- **Email**: xqyww123@gmail.com
- **Issues**: https://github.com/xqyww123/Isa-REPL/issues
- **OCaml Discuss**: https://discuss.ocaml.org/

## ğŸ¯ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# æ„å»ºå’Œæµ‹è¯•
opam exec -- dune build @install
./test_with_server.sh

# æœ¬åœ°å®‰è£…æµ‹è¯•
opam install . --working-dir

# å‘å¸ƒæµç¨‹ï¼ˆä½¿ç”¨ dune-releaseï¼‰
opam exec -- dune-release tag
opam exec -- dune-release distrib
opam exec -- dune-release publish distrib
opam exec -- dune-release opam pkg
opam exec -- dune-release opam submit

# æ‰‹åŠ¨åˆ›å»º tag
git tag -a ocaml-client-v0.13.0 -m "Release v0.13.0"
git push origin ocaml-client-v0.13.0

# è®¡ç®— checksum
sha256sum isa_repl-0.13.0.tbz
sha512sum isa_repl-0.13.0.tbz
```

## âœ¨ æœ€ä½³å®è·µ

1. **ç‰ˆæœ¬å·**: ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬ (MAJOR.MINOR.PATCH)
2. **æµ‹è¯•**: å‘å¸ƒå‰å……åˆ†æµ‹è¯•
3. **æ–‡æ¡£**: ä¿æŒæ–‡æ¡£æ›´æ–°
4. **å“åº”**: åŠæ—¶å“åº”ç»´æŠ¤è€…åé¦ˆ
5. **æ„Ÿè°¢**: æ„Ÿè°¢ OPAM ç»´æŠ¤è€…çš„å·¥ä½œ

## ğŸ‰ å‘å¸ƒæˆåŠŸå

```bash
# ç”¨æˆ·å¯ä»¥è¿™æ ·å®‰è£…ä½ çš„åŒ…
opam update
opam install isa_repl

# åœ¨ä»£ç ä¸­ä½¿ç”¨
(* dune æ–‡ä»¶ *)
(libraries isa_repl)

(* OCaml ä»£ç  *)
open Isa_repl
let client = create "localhost:9000" "HOL"
```

æ­å–œï¼ä½ çš„åŒ…ç°åœ¨å¯ä»¥è¢«å…¨ä¸–ç•Œçš„ OCaml ç”¨æˆ·ä½¿ç”¨äº†ï¼ğŸŒ

---

**ç¥å‘å¸ƒé¡ºåˆ©ï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒè¯¦ç»†æ–‡æ¡£æˆ–è”ç³»ç»´æŠ¤è€…ã€‚** ğŸ’ª
